Configuration du serveur VPN (OpenVPN)

Fichier typique : /etc/openvpn/server.conf

# Sous-r√©seau pour les clients VPN
server 10.8.0.0 255.255.255.0

# Route √† pousser aux clients pour acc√©der au r√©seau interne de l'entreprise
push "route 192.168.0.0 255.255.0.0"

# (Optionnel) rediriger tout le trafic via le VPN
# push "redirect-gateway def1 bypass-dhcp"

# Permet aux clients VPN de communiquer entre eux
client-to-client

# (Optionnel) DNS
push "dhcp-option DNS 8.8.8.8"

Activer le routage IP sur le serveur (Linux)

echo 1 > /proc/sys/net/ipv4/ip_forward

Et pour le rendre permanent :

sudo sysctl -w net.ipv4.ip_forward=1
echo "net.ipv4.ip_forward = 1" | sudo tee -a /etc/sysctl.conf

‚úÖ Routage ou NAT sur le serveur

Les machines du r√©seau interne (192.168.0.0/16) doivent savoir comment retourner les paquets aux clients VPN (10.8.0.0/24). Il y a deux m√©thodes :
‚úÖ Option 1 : Ajouter une route sur les routeurs internes

Sur le(s) routeur(s) de votre r√©seau :

    Destination : 10.8.0.0/24

    Passerelle : l‚ÄôIP interne du serveur VPN (ex : 192.168.1.1)

‚úÖ Option 2 : Faire du NAT (masquage) c√¥t√© serveur VPN

Si vous ne pouvez pas modifier les routeurs internes, vous pouvez masquer le trafic des clients VPN avec iptables :

# Remplacer eth0 par l‚Äôinterface r√©seau vers le LAN (par exemple ens33, eno1‚Ä¶)
iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE

Pour rendre cette r√®gle permanente (Debian/Ubuntu) :

sudo apt install iptables-persistent
sudo netfilter-persistent save

‚úÖ Configuration du client VPN

Dans le fichier .ovpn du client, assurez-vous que la ligne suivante est bien pr√©sente :

pull

Cela permet au client de recevoir les routes envoy√©es par le serveur (comme 192.168.0.0/16).

Configuration typique :

client
dev tun
proto udp
remote mon.serveur.vpn 1194
resolv-retry infinite
nobind

persist-key
persist-tun

remote-cert-tls server

pull

# (Optionnel) pour rediriger tout le trafic via VPN
# redirect-gateway def1

<ca>...</ca>
<cert>...</cert>
<key>...</key>

üîç V√©rification

    Connectez le client VPN.

    Essayez de pinguer une machine sur le r√©seau 192.168.x.x.

    Utilisez la commande traceroute pour v√©rifier que le trafic passe par le tunnel VPN.

    V√©rifiez que les r√©ponses sont bien retourn√©es : si ce n‚Äôest pas le cas, ajoutez une route ou configurez le NAT.

Souhaitez-vous un exemple complet personnalis√© pour votre r√©seau ? Si vous me donnez :

    L‚ÄôIP du serveur VPN,

    Le sous-r√©seau local (ex : 192.168.1.0/24),

    Le nom de l‚Äôinterface r√©seau (ex : eth0, ens33),

je peux g√©n√©rer tous les fichiers de configuration pour vous.
